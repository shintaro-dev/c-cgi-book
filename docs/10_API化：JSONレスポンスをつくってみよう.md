# 10. API化：JSONレスポンスをつくってみよう

## 10.1 APIとは何か？JSONとは？

これまでの章では、HTMLを返すCGIを中心に扱ってきました。  
フォームを送信し、HTMLとして結果を受け取る… これがいわゆる「Webページ」です。

しかし、**WebアプリケーションがWebページだけを相手にしている時代は終わりました**。

- スマートフォンアプリ
- JavaScript（Ajax）を使った動的ページ
- 別のサーバからアクセスするクライアント

これらは、**「HTMLではなくデータそのもの（JSON形式など）」を求めています。**  
そんなときに必要なのが **API（Application Programming Interface）** です。

---

### ■ APIとは？

APIとは「アプリケーションから使うためのインタフェース」のこと。  
Webの世界でのAPIは、通常HTTPを使ってデータをやりとりする仕組みを指します。

たとえば：

- 「IDが100より新しい日記一覧をください」  
  `GET /cgi-bin/api/entries.cgi?after_id=100`

- 「この投稿内容を登録してください」  
  `POST /cgi-bin/api/post_entry.cgi`

といったリクエストに対して、CGIプログラムが**HTMLではなくJSON形式でレスポンスを返す**のが典型的なAPIの姿です。

---

### ■ JSONとは？

JSON（JavaScript Object Notation）は、  
**人にも読みやすく、プログラムでも扱いやすい軽量データ形式**です。

以下のような構造をしています：

```json
{
  "id": 101,
  "title": "はじめての日記",
  "body": "今日はC言語でCGIを書きました。",
  "created_at": "2025-05-03 14:00:00"
}
```

複数件のデータを含むときは配列になります：

```json
[
  { ... },
  { ... }
]
```

C言語には標準でJSONを扱う機能はありませんが、  
**文字列操作とエスケープ処理を工夫すれば、十分に自力で出力できます。**

---

### ■ この章で目指すこと

この章では、次のようなことを実現します：

- `Content-Type: application/json` を返すCGIを作る
- データベース（ODBC）から取得した内容をJSONとして出力する
- GETパラメータで「after_id」を指定して新着データを取得する
- JSONの構造とエスケープ処理の基本を学ぶ

---

> CGIでも、APIはつくれる。  
> 軽量でシンプルなCの力で、データを届けよう。
